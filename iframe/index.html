<!doctype html>
<html lang="zh-Hans">
	<head>
		<meta charset="utf-8" />
		<title>åˆ°åº•æœ‰å¤šå¤§</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<style>
			:root {
				--bg: #f5f7fb;
				--card: #ffffff;
				--accent: #1890ff;
				--muted: #6b7280;
				--radius: 10px;
				--gap: 18px;
				--maxWidth: 980px;
			}

			html,
			body {
				margin: 0;
				font-family: Inter, 'Helvetica Neue', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft Yahei', sans-serif;
				background: linear-gradient(180deg, var(--bg), #eef3fb 60%);
				color: #111827;
				-webkit-font-smoothing: antialiased;
				-moz-osx-font-smoothing: grayscale;
			}

			.container {
				max-width: var(--maxWidth);
				margin: 10 auto;
				padding: 12px;
			}

			.header {
				display: flex;
				align-items: center;
				gap: 16px;
				margin-bottom: 12px;
			}

			.logo {
				width: 56px;
				height: 56px;
				border-radius: 10px;
				background: linear-gradient(135deg, var(--accent), #4db6ff);
				display: flex;
				align-items: center;
				justify-content: center;
				color: #fff;
				font-weight: 700;
				font-size: x-large;
				box-shadow: 0 6px 18px rgba(24, 144, 255, 0.18);
				flex: 0 0 56px;
			}

			h1 {
				margin: 0;
				font-size: 20px;
			}

			p.lead {
				margin: 4px 0 0 0;
				color: var(--muted);
				font-size: 13px;
			}

			.board {
				display: grid;
				gap: var(--gap);
				grid-template-columns: 1fr;
			}

			.step {
				background: var(--card);
				padding: 18px;
				border-radius: var(--radius);
				box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
				border: 1px solid rgba(15, 23, 42, 0.03);
				position: relative;
				overflow: hidden;
			}

			.step::before {
				content: attr(data-step);
				position: absolute;
				left: 18px;
				top: 18px;
				width: 36px;
				height: 36px;
				border-radius: 50%;
				background: linear-gradient(180deg, #fff, var(--card));
				border: 2px solid rgba(0, 0, 0, 0.04);
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: 700;
				color: var(--accent);
				box-shadow: 0 6px 14px rgba(24, 144, 255, 0.06);
				font-size: 14px;
			}

			.step .inner {
				margin-left: 66px;
			}

			.step h3 {
				margin: 0 0 6px 0;
				font-size: 15px;
			}

			.step .desc {
				margin: 0 0 12px 0;
				color: var(--muted);
				font-size: 13px;
			}

			.form-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
				gap: 12px;
			}

			label {
				display: block;
				font-size: 13px;
				margin-bottom: 6px;
				color: #344054;
			}

			input[type='number'] {
				width: 100%;
				padding: 10px 12px;
				border: 1px solid #e6edf3;
				border-radius: 8px;
				font-size: 14px;
				background: #fbfdff;
				box-sizing: border-box;
				transition:
					box-shadow 0.12s,
					border-color 0.12s;
			}

			input[type='number']:focus {
				outline: none;
				border-color: rgba(24, 144, 255, 0.9);
				box-shadow: 0 6px 18px rgba(24, 144, 255, 0.08);
			}

			.controls {
				display: flex;
				gap: 10px;
				margin-top: 12px;
				align-items: center;
				flex-wrap: wrap;
			}

			button {
				padding: 10px 14px;
				border-radius: 8px;
				border: none;
				cursor: pointer;
				font-size: 14px;
			}

			.btn-primary {
				background: var(--accent);
				color: #fff;
				box-shadow: 0 8px 24px rgba(24, 144, 255, 0.12);
			}

			.btn-ghost {
				background: transparent;
				color: #0f1724;
				border: 1px solid #e6edf3;
			}

			.hint {
				color: var(--muted);
				font-size: 13px;
			}

			.result-row {
				display: flex;
				gap: 12px;
				flex-wrap: wrap;
				margin-top: 12px;
			}

			.chip {
				background: #f8fafc;
				border: 1px solid #eef2f7;
				padding: 8px 12px;
				border-radius: 999px;
				font-size: 13px;
				color: #0f1724;
			}

			.footer-note {
				margin-top: 6px;
				font-size: 12px;
				color: var(--muted);
			}

			/* compact layout for small screens */
			@media (max-width: 540px) {
				.header {
					gap: 10px;
				}

				.step::before {
					left: 14px;
					top: 14px;
				}

				.step .inner {
					margin-left: 60px;
				}

				.container {
					padding: 16px;
				}
			}

			/* æš—è‰²æ¨¡å¼æ ·å¼ */
			@media (prefers-color-scheme: dark) {
				:root {
					--bg: #0f1724;
					--card: #1e293b;
					--accent: #3ea6ff;
					--muted: #9ca3af;
					--red: #f87171;
				}

				body {
					background: linear-gradient(180deg, var(--bg), #111827 60%);
					color: #f9fafb;
				}

				.logo {
					background: linear-gradient(135deg, var(--accent), #60b5ff);
					box-shadow: 0 6px 18px rgba(62, 166, 255, 0.18);
				}

				.step {
					background: var(--card);
					box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
					border: 1px solid rgba(255, 255, 255, 0.06);
				}

				.step::before {
					background: linear-gradient(135deg, #1e293b, var(--card));
					border: 2px solid rgba(255, 255, 255, 0.06);
					color: var(--accent);
					box-shadow: 0 6px 14px rgba(62, 166, 255, 0.06);
				}

				label {
					color: #cbd5e1;
				}

				input::-webkit-outer-spin-button,
				input::-webkit-inner-spin-button {
					-webkit-appearance: none !important;
					margin: 0;
				}

				input[type='number'] {
					background: #273449;
					border: 1px solid #374151;
					color: #f9fafb;
				}

				input[type='number']:focus {
					border-color: rgba(62, 166, 255, 0.9);
					box-shadow: 0 6px 18px rgba(62, 166, 255, 0.08);
				}

				.btn-primary {
					background: var(--accent);
					box-shadow: 0 8px 24px rgba(62, 166, 255, 0.12);
				}

				.btn-red {
					color: #f9fafb;
					background: var(--red);
					box-shadow: 0 8px 24px rgba(62, 166, 255, 0.12);
				}

				.btn-ghost {
					color: #f9fafb;
					border: 1px solid #374151;
				}

				.chip {
					background: #334155;
					border: 1px solid #475569;
					color: #f9fafb;
				}
			}
		</style>
	</head>

	<body>
		<div class="container">
			<div class="header">
				<div class="logo">ğŸ”</div>
				<div>
					<h1>åˆ°åº•æœ‰å¤šå¤§ï¼Ÿ</h1>
					<p class="lead">ç¼©æ”¾æ˜¾ç¤ºæ¯”ä¾‹ï¼Œçœ‹çœ‹PCBåœ¨ç°å®ä¸­åˆ°åº•æœ‰å¤šå¤§ã€‚</p>
				</div>
			</div>

			<div class="board">
				<!-- Step 1 -->
				<section class="step" data-step="1">
					<div class="inner">
						<h3>æ­¥éª¤ 1 Â· é€‰æ‹©æ”¾ç½®åŸç‚¹ã€çº¿æ®µé•¿åº¦å’Œç¼©æ”¾æ¯”ä¾‹</h3>
						<p class="desc">è®¾ç½®ç›¸å…³å‚æ•°ï¼Œéå¿…è¦å¯ä½¿ç”¨é»˜è®¤å€¼ã€‚</p>

						<div class="form-grid">
							<div>
								<label for="originX">åŸç‚¹ X (mm)</label>
								<input id="originX" type="number" value="100" step="1" />
							</div>
							<div>
								<label for="originY">åŸç‚¹ Y (mm)</label>
								<input id="originY" type="number" value="100" step="1" />
							</div>
							<div>
								<label for="segmentLength">çº¿æ®µé•¿åº¦ (mm)</label>
								<input id="segmentLength" type="number" value="8" min="1" step="1" />
							</div>
						</div>

						<div class="form-grid" style="margin-top: 16px">
							<div>
								<label for="zoomScale">ç¼©æ”¾æ¯”ä¾‹ï¼ˆ%ï¼‰</label>
								<input id="zoomScale" type="number" value="1000" min="1" step="1" />
							</div>
						</div>

						<div class="controls">
							<button id="placeSegmentBtn" class="btn-primary">åœ¨ PCB ä¸Šæ”¾ç½®çº¿æ®µå¹¶ç¼©æ”¾</button>
							<div class="hint">ç‚¹å‡»åè¯·åˆ‡æ¢å› PCB ç¼–è¾‘å™¨æµ‹é‡çº¿æ®µé•¿åº¦ï¼Œæµ‹é‡æœŸé—´è¯·å‹¿ç¼©æ”¾ã€‚</div>
						</div>
					</div>
				</section>

				<!-- Step 2 -->
				<section class="step" data-step="2">
					<div class="inner">
						<h3>æ­¥éª¤ 2 Â· å¡«å…¥æ˜¾ç¤ºå™¨ä¸Šçš„å®é™…é•¿åº¦</h3>
						<p class="desc">æµ‹é‡å‡ºå±å¹•ä¸Šæ‰€æ”¾ç½®çº¿æ®µçš„çœŸå®é•¿åº¦ï¼ˆå•ä½ä¸ºæ¯«ç±³ï¼‰å¹¶å¡«å†™åœ¨ä¸‹æ–¹ã€‚</p>

						<div class="form-grid">
							<div>
								<label for="displayActualLength">å®é™…é•¿åº¦ (mm)</label>
								<input id="displayActualLength" type="number" value="10" min="0" step="0.01" />
							</div>
						</div>
					</div>
				</section>

				<!-- Step 3 -->
				<section class="step" data-step="3">
					<div class="inner">
						<h3>æ­¥éª¤ 3 Â· æ‰§è¡Œç¼©æ”¾å¹¶æŸ¥çœ‹ç»“æœ</h3>
						<p class="desc">æ ¸å¯¹é•¿åº¦å¹¶æ‰§è¡Œç¼©æ”¾æ“ä½œã€‚</p>

						<div class="controls">
							<button id="showConfigBtn" class="btn-primary">çœ‹çœ‹åˆ°åº•æœ‰å¤šå¤§</button>
							<button id="reset" class="btn-red">é‡ç½®è¾“å…¥æ¡†é»˜è®¤å€¼</button>
						</div>
					</div>
				</section>
			</div>
		</div>

		<script>
			// æ ¹æ® net åˆ é™¤ Document å±‚çš„çº¿æ®µ
			function deleteLinesByNetOnDocumentLayer(net) {
				eda.pcb_PrimitiveLine
					.getAll(net, EPCB_LayerId.DOCUMENT)
					.then((e) => {
						eda.pcb_PrimitiveLine.delete(e);
					})
					.catch((err) => {
						console.error(err);
					});
			}

			// æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ Toast å°è£…
			function showErrorToast(err) {
				const errText = err.name + ': ' + err.message;
				eda.sys_Message.showToastMessage(errText, ESYS_ToastMessageType.ERROR);
			}

			// ç›‘å¬è¾“å…¥æ¡†çš„å˜åŠ¨ï¼Œå¹¶å®æ—¶å°†å€¼ä¿å­˜åˆ° localStorage
			const keys = {
				originX: 'pcb:originX',
				originY: 'pcb:originY',
				segmentLength: 'pcb:segmentLength',
				displayActualLength: 'pcb:displayActualLength',
				zoomScale: 'pcb:zoomScale',
			};

			const el = (id) => document.getElementById(id);

			const originX = el('originX');
			const originY = el('originY');
			const segmentLength = el('segmentLength');
			const displayActualLength = el('displayActualLength');
			const placeSegmentBtn = el('placeSegmentBtn');
			const showConfigBtn = el('showConfigBtn');

			// ç¼©æ”¾æ¯”ç‡
			const zoomScale = el('zoomScale');

			// ä» localStorage æ¢å¤
			function restore() {
				if (localStorage.getItem(keys.originX) !== null) originX.value = localStorage.getItem(keys.originX);
				if (localStorage.getItem(keys.originY) !== null) originY.value = localStorage.getItem(keys.originY);
				if (localStorage.getItem(keys.segmentLength) !== null) segmentLength.value = localStorage.getItem(keys.segmentLength);
				if (localStorage.getItem(keys.displayActualLength) !== null)
					displayActualLength.value = localStorage.getItem(keys.displayActualLength);

				if (localStorage.getItem(keys.zoomScale) !== null) zoomScale.value = localStorage.getItem(keys.zoomScale);
			}
			restore();

			// ä¿å­˜åˆ° localStorage
			function saveAll() {
				localStorage.setItem(keys.originX, originX.value);
				localStorage.setItem(keys.originY, originY.value);
				localStorage.setItem(keys.segmentLength, segmentLength.value);
				localStorage.setItem(keys.displayActualLength, displayActualLength.value);

				localStorage.setItem(keys.zoomScale, zoomScale.value);
			}

			// å¯¹è¾“å…¥æ¡†å˜åŒ–è¿›è¡Œç›‘å¬å¹¶ä¿å­˜
			[originX, originY, segmentLength, displayActualLength, zoomScale].forEach((input) => {
				input.addEventListener('input', saveAll);
			});

			// ç‚¹å‡»â€œé‡ç½®è¾“å…¥æ¡†é»˜è®¤å€¼â€ -> æ¸…é™¤ localStorage å¹¶æ¢å¤é»˜è®¤å€¼
			document.getElementById('reset').addEventListener('click', () => {
				// æ¸…é™¤å½“å‰ origin ä¸‹çš„æ‰€æœ‰ localStorage é¡¹
				localStorage.clear();

				// å°†è¾“å…¥æ¡†æ¢å¤ä¸ºé»˜è®¤å€¼
				originX.value = '100';
				originY.value = '100';
				segmentLength.value = '8';
				displayActualLength.value = '10';

				zoomScale.value = '1000';

				// å°†é»˜è®¤å€¼ä¿å­˜å› localStorageï¼ˆå¯é€‰ï¼Œä¾¿äºä¸‹ä¸€æ¬¡æ‰“å¼€æ—¶æ¢å¤ï¼‰
				saveAll();
			});

			// ç‚¹å‡»â€œåœ¨ PCB ä¸Šæ”¾ç½®çº¿æ®µå¹¶ç¼©æ”¾â€æŒ‰é’®
			placeSegmentBtn.addEventListener('click', () => {
				try {
					// å…ˆåˆ é™¤ä¹‹å‰æ”¾ç½®çš„çº¿æ®µï¼Œé¿å…é‡å¤æ”¾ç½®
					deleteLinesByNetOnDocumentLayer('h0wB!g!$!t');

					// åœ¨ PCB ä¸Šæ”¾ç½®çº¿æ®µ
					eda.pcb_PrimitiveLine.create(
						'h0wB!g!$!t',
						EPCB_LayerId.DOCUMENT,
						parseFloat(originX.value * 39.37),
						parseFloat(originY.value * 39.37),
						parseFloat(originX.value * 39.37) + parseFloat(segmentLength.value * 39.37),
						parseFloat(originY.value * 39.37),
					);

					// æ‰§è¡Œç¼©æ”¾ï¼Œè¿™é‡Œçš„scaleå¥½åƒå’Œæ–‡æ¡£çš„å‚æ•°æè¿°ä¸ä¸€è‡´ï¼Œæ²¡æœ‰ç»†çœ‹
					eda.dmt_EditorControl.zoomTo(
						parseFloat(originX.value * 39.37),
						parseFloat(originY.value * 39.37),
						parseFloat(zoomScale.value) / 100,
					);
				} catch (err) {
					showErrorToast(err);
					console.error(err);
				} finally {
					eda.sys_Message.showToastMessage('æˆåŠŸæ”¾ç½®çº¿æ®µï¼Œè¯·æµ‹é‡çº¿æ®µé•¿åº¦ï¼Œæµ‹é‡æœŸé—´è¯·å‹¿ç¼©æ”¾ã€‚', ESYS_ToastMessageType.SUCCESS);
				}
			});

			// ç‚¹å‡»â€œçœ‹çœ‹åˆ°åº•æœ‰å¤šå¤§â€æŒ‰é’®
			showConfigBtn.addEventListener('click', () => {
				try {
					// è®¡ç®—å®é™…ç¼©æ”¾æ¯”ä¾‹
					const segmentLengthMil = parseFloat(segmentLength.value * 39.37);
					const displayLengthMil = parseFloat(displayActualLength.value * 39.37);
					const actualZoomScale = (segmentLengthMil / displayLengthMil) * zoomScale.value;

					// æ‰§è¡Œç¼©æ”¾
					eda.dmt_EditorControl.zoomTo(0, 0, actualZoomScale / 100);

					// æ˜¾ç¤ºç»“æœ
					eda.sys_Message.showToastMessage(`å·²æŒ‰å®é™…é•¿åº¦ ${segmentLength.value} mm è¿›è¡Œç¼©æ”¾ï¼Œå½“å‰ç¼©æ”¾æ¯”ä¾‹ä¸º ${actualZoomScale}%ã€‚`);
				} catch (err) {
					showErrorToast(err);
					console.error(err);
				} finally {
					// åˆ é™¤æ”¾ç½®çš„çº¿æ®µ
					deleteLinesByNetOnDocumentLayer('h0wB!g!$!t');
				}
			});
		</script>
	</body>
</html>
